<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API: Main Controller</title>
    <meta name="HandheldFriendly" content="true" />
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/8.5.0/styles/solarized_light.min.css" /><link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/alinex/node-report/v2.1.2/var/src/template/report/codedoc.css" />
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#topnav" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://alinex.github.io/" onmouseover="logo.src='http://alinex.github.io/images/Alinex-200.png'" onmouseout="logo.src='http://alinex.github.io/images/Alinex-black-200.png'">
            <img name="logo" src="http://alinex.github.io/images/Alinex-black-200.png" width="150" title="Alinex Homepage">
          </a>
          <img class="preload" src="http://alinex.github.io/images/Alinex-200.png" aria-hidden="true">
        </div>
        <div id="topnav" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://alinex.github.io/blog" class="btn btn-primary">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Blog
              </a></li>
            <li><a href="http://alinex.github.io/develop" class="btn btn-primary">
                <span class="glyphicon glyphicon-book" aria-hidden="true"></span> Develop
              </a></li>
            <li><a href="http://alinex.github.io/code.html" class="btn btn-warning">
                <span class="glyphicon glyphicon-cog" aria-hidden="true"></span> Code
              </a></li>
          </ul>
          <form class="navbar-form navbar-right">
            <input type="text" class="form-control" placeholder="Search...">
          </form>
        </div>
      </div>
    </nav>

    <div class="navbar-spacer"></div>

    <div class="container-fluid">
      <div class="row">

        <div class="col-sm-9 col-sm-push-3 col-md-10 col-md-push-2 main">
          <h1 id="api-main-controller">API: Main Controller</h1>
<p>This class is loaded by the CLI call or from other packages. This collects all
accessible methods to use the package.</p>
<h2 id="node-modules">Node Modules</h2>
<pre style="counter-reset:line 11" class="language coffeescript"><header>CoffeeScript Code</header><code><span class="hljs-comment"># include base modules</span></code>
<code>debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>) <span class="hljs-string">'codedoc'</span></code>
<code>chalk = <span class="hljs-built_in">require</span> <span class="hljs-string">'chalk'</span></code>
<code>path = <span class="hljs-built_in">require</span> <span class="hljs-string">'path'</span></code>
<code>async = <span class="hljs-built_in">require</span> <span class="hljs-string">'async'</span></code>
<code>isBinaryFile = <span class="hljs-built_in">require</span> <span class="hljs-string">'isbinaryfile'</span></code>
<code><span class="hljs-comment"># include alinex modules</span></code>
<code>util = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-util'</span></code>
<code>fs = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-fs'</span></code>
<code>Report = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-report'</span></code>
<code>config = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-config'</span></code>
<code><span class="hljs-comment"># internal methods</span></code>
<code>language = <span class="hljs-built_in">require</span> <span class="hljs-string">'./language'</span></code></pre>
<h2 id="initialize">Initialize</h2>
<pre class="language coffeescript"><header>CoffeeScript Code</header><code>exports.setup = util.function.once <span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span></code>
<code>  debug chalk.grey <span class="hljs-string">"setup codedoc component"</span></code>
<code>  async.each [Report], <span class="hljs-function"><span class="hljs-params">(mod, cb)</span> -&gt;</span></code>
<code>    mod.setup cb</code>
<code>  , <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span></code>
<code>    <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err</code>
<code>    <span class="hljs-comment"># set module search path</span></code>
<code>    config.register <span class="hljs-string">'codedoc'</span>, path.dirname(__dirname),</code>
<code>      folder: <span class="hljs-string">'template'</span></code>
<code>      type: <span class="hljs-string">'template'</span></code>
<code>    cb()</code>
<code></code>
<code></code>
<code>exports.run = <span class="hljs-function"><span class="hljs-params">(setup, cb)</span> -&gt;</span></code>
<code>  <span class="hljs-comment"># set up system</span></code>
<code>  setup.input ?= <span class="hljs-string">'.'</span></code>
<code>  setup.input = path.resolve setup.input ? <span class="hljs-string">'.'</span></code>
<code>  setup.output = path.resolve setup.output ? <span class="hljs-string">'.'</span></code>
<code>  setup.find ?= {}</code>
<code>  setup.find.type = <span class="hljs-string">'file'</span></code>
<code>  setup.brand ?= <span class="hljs-string">'alinex'</span></code>
<code>  <span class="hljs-comment"># start converting</span></code>
<code>  <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Output to <span class="hljs-subst">#{setup.output}</span>..."</span></code>
<code>  fs.mkdirs setup.output, <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span></code>
<code>    <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err</code>
<code>    <span class="hljs-comment"># start</span></code>
<code>    debug <span class="hljs-string">"search files in <span class="hljs-subst">#{setup.input}</span>"</span></code>
<code>    fs.find setup.input, setup.find, <span class="hljs-function"><span class="hljs-params">(err, list)</span> -&gt;</span></code>
<code>      <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err</code>
<code>      debug <span class="hljs-string">"convert files..."</span></code>
<code>      map = {}</code>
<code>      async.eachLimit list, <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-params">(file, cb)</span> -&gt;</span></code>
<code>        processFile file, <span class="hljs-function"><span class="hljs-params">(err, report)</span> -&gt;</span></code>
<code>          <span class="hljs-keyword">if</span> err</code>
<code>            <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err <span class="hljs-keyword">instanceof</span> Error</code>
<code>            <span class="hljs-keyword">return</span> cb() <span class="hljs-comment"># no real problem but abort</span></code>
<code>          p = file[setup.input.length..]</code>
<code>          map[p] =</code>
<code>            report: report</code>
<code>            dest: <span class="hljs-string">"<span class="hljs-subst">#{setup.output}</span><span class="hljs-subst">#{p}</span>.html"</span></code>
<code>            parts: p[<span class="hljs-number">1.</span>.].toLowerCase().split <span class="hljs-regexp">/\//</span></code>
<code>            title: report.getTitle() ? p[<span class="hljs-number">1.</span>.]</code>
<code>          cb()</code>
<code>      , <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span></code>
<code>        <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err</code>
<code>        map = sortMap map</code>
<code>        mapKeys = Object.keys map</code>
<code>        moduleName = map[mapKeys[<span class="hljs-number">0</span>]].title.replace <span class="hljs-regexp">/\s*[-:].*/</span>, <span class="hljs-string">''</span></code>
<code>        .replace <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">"^<span class="hljs-subst">#{setup.brand}</span>\\s+"</span>, <span class="hljs-string">'i'</span>), <span class="hljs-string">''</span></code>
<code>        async.eachLimit mapKeys, <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-params">(name, cb)</span> -&gt;</span></code>
<code>          <span class="hljs-comment"># create link list</span></code>
<code>          files = []</code>
<code>          <span class="hljs-keyword">for</span> p, e <span class="hljs-keyword">of</span> map</code>
<code>            files.push</code>
<code>              depth: e.parts.length - <span class="hljs-number">1</span></code>
<code>              title: e.title</code>
<code>              path: p</code>
<code>              link: e.title.replace <span class="hljs-regexp">/^.*?[-:]\s+/</span>, <span class="hljs-string">''</span></code>
<code>              url: <span class="hljs-string">"<span class="hljs-subst">#{path.relative path.dirname(name), p}</span>.html"</span></code>
<code>              active: p <span class="hljs-keyword">is</span> name</code>
<code>          <span class="hljs-comment"># convert to html</span></code>
<code>          file = map[name]</code>
<code>          file.report.toHtml</code>
<code>            style: <span class="hljs-string">'codedoc'</span></code>
<code>            context:</code>
<code>              moduleName: moduleName</code>
<code>              files: files</code>
<code>          , <span class="hljs-function"><span class="hljs-params">(err, html)</span> -&gt;</span></code>
<code>            fs.mkdirs path.dirname(file.dest), <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span></code>
<code>              <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err</code>
<code>              fs.writeFile file.dest, html, <span class="hljs-string">'utf8'</span>, cb</code>
<code>        , cb</code>
<code><span class="hljs-function"></code>
<code><span class="hljs-title">processFile</span> = <span class="hljs-params">(file, cb)</span> -&gt;</span></code>
<code>  async.waterfall [</code>
<code>    <span class="hljs-comment"># get file</span></code>
<code>    (cb) -&gt;</code>
<code>      debug <span class="hljs-string">"analyze <span class="hljs-subst">#{file}</span>"</span></code>
<code>      fs.readFile file, <span class="hljs-function"><span class="hljs-params">(err, buffer)</span> -&gt;</span></code>
<code>        <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err</code>
<code>        isBinaryFile buffer, buffer.length, <span class="hljs-function"><span class="hljs-params">(err, binary)</span> -&gt;</span></code>
<code>          <span class="hljs-keyword">return</span> cb err ? <span class="hljs-string">'BINARY'</span> <span class="hljs-keyword">if</span> err <span class="hljs-keyword">or</span> binary</code>
<code>          cb <span class="hljs-literal">null</span>, buffer.toString <span class="hljs-string">'utf8'</span></code>
<code>    <span class="hljs-comment"># analyze language</span></code>
<code>    (contents, cb) -&gt;</code>
<code>      lang = language file, contents</code>
<code>      <span class="hljs-keyword">unless</span> lang</code>
<code>        debug chalk.magenta <span class="hljs-string">"could not detect language of <span class="hljs-subst">#{file}</span>"</span></code>
<code>        <span class="hljs-keyword">return</span> cb <span class="hljs-string">'UNKNOWN'</span></code>
<code>      debug chalk.grey <span class="hljs-string">"<span class="hljs-subst">#{lang.name}</span>: <span class="hljs-subst">#{file}</span>"</span></code>
<code>      cb <span class="hljs-literal">null</span>, contents, lang</code>
<code>    <span class="hljs-comment"># create report</span></code>
<code>    (contents, lang, cb) -&gt;</code>
<code>      report = <span class="hljs-keyword">new</span> Report()</code>
<code>      <span class="hljs-keyword">if</span> lang.name <span class="hljs-keyword">is</span> <span class="hljs-string">'markdown'</span></code>
<code>        report.raw contents</code>
<code>      <span class="hljs-keyword">else</span></code>
<code>        <span class="hljs-comment"># document comments</span></code>
<code>        docs = []</code>
<code>        <span class="hljs-keyword">if</span> lang.doc</code>
<code>          <span class="hljs-keyword">for</span> re <span class="hljs-keyword">in</span> lang.doc</code>
<code>            <span class="hljs-keyword">while</span> match = re.exec contents</code>
<code>              docs.push [match.index, match.index + match[<span class="hljs-number">0</span>].length, match[<span class="hljs-number">1</span>]]</code>
<code>        <span class="hljs-comment"># sort found sections</span></code>
<code>        docs.sort (a, b) -&gt;</code>
<code>          <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">if</span> a[<span class="hljs-number">0</span>] &lt; b[<span class="hljs-number">0</span>]</code>
<code>          <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> a[<span class="hljs-number">0</span>] &gt; b[<span class="hljs-number">0</span>]</code>
<code>          <span class="hljs-number">0</span></code>
<code>        <span class="hljs-comment"># create report</span></code>
<code>        pos = <span class="hljs-number">0</span></code>
<code>        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> docs</code>
<code>          <span class="hljs-keyword">if</span> pos &lt; doc[<span class="hljs-number">0</span>]</code>
<code>            report.code trim(contents[pos..doc[<span class="hljs-number">0</span>]]), lang.name</code>
<code>            report.p Report.style <span class="hljs-string">'code: style="counter-reset:line 11"'</span></code>
<code>          report.raw doc[<span class="hljs-number">2</span>]</code>
<code>          pos = doc[<span class="hljs-number">1</span>]</code>
<code>        <span class="hljs-keyword">if</span> pos &lt; contents.length</code>
<code>          report.code trim(contents[pos..]), lang.name</code>
<code>      cb <span class="hljs-literal">null</span>, report</code>
<code>  ], cb</code>
<code></code>
<code>orderFirst = [</code>
<code>  <span class="hljs-string">'readme.*'</span></code>
<code>  <span class="hljs-string">'/man'</span></code>
<code>  <span class="hljs-string">'index.*'</span></code>
<code>  <span class="hljs-string">'/src'</span></code>
<code>]</code>
<code>orderLast = [</code>
<code>  <span class="hljs-string">'/bin'</span></code>
<code>  <span class="hljs-string">'/lib'</span></code>
<code>  <span class="hljs-string">'/var'</span></code>
<code>  <span class="hljs-string">'.travis.yml'</span></code>
<code>]</code>
<code><span class="hljs-function"><span class="hljs-title">sortMap</span> = <span class="hljs-params">(map)</span> -&gt;</span></code>
<code>  list = Object.keys(map).map (e) -&gt;</code>
<code>    parts = map[e].parts[..<span class="hljs-number">-2</span>].map (p) -&gt; <span class="hljs-string">"/<span class="hljs-subst">#{p}</span>"</span></code>
<code>    parts.push map[e].parts[map[e].parts.length<span class="hljs-number">-1</span>]</code>
<code>    sortnum = parts.map (p) -&gt;</code>
<code>      check = [p]</code>
<code>      <span class="hljs-keyword">if</span> ~p.indexOf <span class="hljs-string">'.'</span></code>
<code>        check.push <span class="hljs-string">"*<span class="hljs-subst">#{path.extname p}</span>"</span></code>
<code>        check.push <span class="hljs-string">"<span class="hljs-subst">#{path.basename p, path.extname p}</span>.*"</span></code>
<code>      <span class="hljs-keyword">for</span> v, i <span class="hljs-keyword">in</span> orderFirst</code>
<code>        <span class="hljs-keyword">continue</span> <span class="hljs-keyword">unless</span> v <span class="hljs-keyword">in</span> check</code>
<code>        <span class="hljs-keyword">return</span> util.string.lpad(i, <span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>) + util.string.rpad(p, <span class="hljs-number">10</span>, <span class="hljs-string">'_'</span>)</code>
<code>      <span class="hljs-keyword">for</span> v, i <span class="hljs-keyword">in</span> orderLast</code>
<code>        <span class="hljs-keyword">continue</span> <span class="hljs-keyword">unless</span> v <span class="hljs-keyword">in</span> check</code>
<code>        <span class="hljs-keyword">return</span> util.string.lpad(<span class="hljs-number">51</span> + i, <span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>) + util.string.rpad(p, <span class="hljs-number">10</span>, <span class="hljs-string">'_'</span>)</code>
<code>      <span class="hljs-number">50</span> + util.string.rpad(p, <span class="hljs-number">10</span>, <span class="hljs-string">'_'</span>)</code>
<code>    .join <span class="hljs-string">''</span></code>
<code>    <span class="hljs-string">"<span class="hljs-subst">#{sortnum}</span> =&gt; <span class="hljs-subst">#{e}</span>"</span></code>
<code>  list.sort()</code>
<code>  list = list.map (e) -&gt; e.split(/ =&gt; /)[<span class="hljs-number">1</span>]</code>
<code>  sorted = {}</code>
<code>  sorted[k] = map[k] <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> list</code>
<code>  sorted</code>
<code><span class="hljs-function"></code>
<code><span class="hljs-title">trim</span> = <span class="hljs-params">(code)</span> -&gt;</span></code>
<code>  code</code></pre>

        </div>

        <div class="col-sm-3 col-cm-pull-9 col-md-2 col-md-pull-10 sidebar">
          <h1>Further pages</h1>
          <ul class="nav nav-sidebar">
            <li class="header">
              <a href="../README.md.html">CodeDoc</a>
            </li>
                <li class="level0">
                  <a href="../README.md.html" title="Alinex CodeDoc: Readme (/README.md)">Readme</a>
                </li>
                <li class="level2">
                  <a href="man/codedoc.1.md.html" title="codedoc(1) - manpage (/src/man/codedoc.1.md)">manpage</a>
                </li>
                <li class="active level1">
                  <a href="index.coffee.html" title="API: Main Controller (/src/index.coffee)">Main Controller <span class="sr-only">(current)</span></a>
                </li>
                <li class="level1">
                  <a href="cli.coffee.html" title="Startup script (/src/cli.coffee)">Startup script</a>
                </li>
                <li class="level1">
                  <a href="language.coffee.html" title="Startup script (/src/language.coffee)">Startup script</a>
                </li>
                <li class="level0">
                  <a href="../Changelog.md.html" title="Version changes (/Changelog.md)">Version changes</a>
                </li>
                <li class="level0">
                  <a href="../coffeelint.json.html" title="coffeelint.json (/coffeelint.json)">coffeelint.json</a>
                </li>
                <li class="level0">
                  <a href="../package.json.html" title="package.json (/package.json)">package.json</a>
                </li>
                <li class="level1">
                  <a href="../bin/codedoc.html" title="bin/codedoc (/bin/codedoc)">bin/codedoc</a>
                </li>
                <li class="level4">
                  <a href="../var/src/template/report/codedoc.css.html" title="var/src/template/report/codedoc.css (/var/src/template/report/codedoc.css)">var/src/template/report/codedoc.css</a>
                </li>
                <li class="level4">
                  <a href="../var/src/template/report/codedoc.styl.html" title="var/src/template/report/codedoc.styl (/var/src/template/report/codedoc.styl)">var/src/template/report/codedoc.styl</a>
                </li>
                <li class="level0">
                  <a href="../.travis.yml.html" title=".travis.yml (/.travis.yml)">.travis.yml</a>
                </li>
          </ul>
        </div>

      </div>
    </div>

    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  </body>
</html>
